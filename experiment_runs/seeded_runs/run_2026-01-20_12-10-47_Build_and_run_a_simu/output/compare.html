<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boids Comparison Tool - Side-by-Side Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
        }

        h1 {
            color: #4ec9b0;
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .simulation-panel {
            flex: 1;
            background: #252525;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .panel-title {
            color: #4ec9b0;
            font-size: 1.2em;
            font-weight: bold;
        }

        .preset-selector {
            padding: 5px 10px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 0.9em;
        }

        canvas {
            display: block;
            background: #0a0a0a;
            border: 2px solid #333;
            border-radius: 4px;
            width: 100%;
            margin-bottom: 15px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .control-label {
            font-size: 0.85em;
            color: #aaa;
            min-width: 120px;
        }

        .control-value {
            font-size: 0.85em;
            color: #4ec9b0;
            font-weight: bold;
            min-width: 40px;
            text-align: right;
        }

        .slider {
            flex: 1;
            margin: 0 10px;
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            background: #333;
            border-radius: 2px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            background: #4ec9b0;
            border-radius: 50%;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: #4ec9b0;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .global-controls {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: #252525;
            border: 1px solid #333;
            border-radius: 8px;
        }

        .button {
            padding: 10px 20px;
            margin: 0 5px;
            background: #4ec9b0;
            color: #1a1a1a;
            border: none;
            border-radius: 4px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        .button:hover {
            background: #5ed9c0;
        }

        .button.secondary {
            background: #555;
            color: #e0e0e0;
        }

        .button.secondary:hover {
            background: #666;
        }

        .stats {
            font-size: 0.8em;
            color: #888;
            margin-top: 10px;
            text-align: center;
        }

        .description {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-size: 0.85em;
            line-height: 1.5;
        }

        .description-title {
            color: #4ec9b0;
            font-weight: bold;
            margin-bottom: 5px;
        }

        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <h1>üê¶ Boids Comparison Tool</h1>
    <p class="subtitle">Compare different parameter sets side-by-side to understand emergent behavior</p>

    <div class="global-controls">
        <button class="button" id="playPauseBtn">‚è∏Ô∏è Pause</button>
        <button class="button secondary" id="resetBtn">üîÑ Reset Positions</button>
        <button class="button secondary" id="syncBtn">üîó Sync Positions</button>
        <div class="stats">
            <span id="fps">FPS: 60</span> |
            <span>Total Boids: <span id="totalBoids">100</span></span>
        </div>
    </div>

    <div class="container" id="container"></div>

    <script src="vector.js"></script>
    <script src="boid.js"></script>
    <script src="simulation.js"></script>
    <script>
        // Preset configurations for comparison
        const PRESETS = {
            'balanced': {
                name: 'Balanced Flock',
                description: 'Classic balanced flocking with all three behaviors working together harmoniously.',
                maxSpeed: 4.0,
                maxForce: 0.1,
                perceptionRadius: 50,
                separationWeight: 1.5,
                alignmentWeight: 1.0,
                cohesionWeight: 1.0
            },
            'tight-swarm': {
                name: 'Tight Swarm',
                description: 'Dense, tightly-packed groups with strong separation to prevent collisions.',
                maxSpeed: 3.0,
                maxForce: 0.1,
                perceptionRadius: 30,
                separationWeight: 2.0,
                alignmentWeight: 1.0,
                cohesionWeight: 0.5
            },
            'flowing-school': {
                name: 'Flowing School',
                description: 'Large, flowing formations like fish schools with high cohesion.',
                maxSpeed: 4.0,
                maxForce: 0.1,
                perceptionRadius: 100,
                separationWeight: 0.5,
                alignmentWeight: 1.0,
                cohesionWeight: 2.0
            },
            'chaotic': {
                name: 'Chaotic Scatter',
                description: 'Unpredictable darting behavior with minimal alignment.',
                maxSpeed: 8.0,
                maxForce: 0.15,
                perceptionRadius: 40,
                separationWeight: 1.5,
                alignmentWeight: 0.1,
                cohesionWeight: 1.0
            },
            'slow-ballet': {
                name: 'Slow Ballet',
                description: 'Graceful, slow-motion flocking with smooth, deliberate movements.',
                maxSpeed: 2.0,
                maxForce: 0.08,
                perceptionRadius: 60,
                separationWeight: 1.5,
                alignmentWeight: 1.0,
                cohesionWeight: 1.0
            },
            'separation-only': {
                name: 'Separation Only',
                description: 'Pure separation behavior - boids spread out and avoid each other.',
                maxSpeed: 4.0,
                maxForce: 0.1,
                perceptionRadius: 50,
                separationWeight: 1.5,
                alignmentWeight: 0.0,
                cohesionWeight: 0.0
            },
            'alignment-only': {
                name: 'Alignment Only',
                description: 'Pure alignment behavior - boids move in parallel but stay scattered.',
                maxSpeed: 4.0,
                maxForce: 0.1,
                perceptionRadius: 50,
                separationWeight: 0.0,
                alignmentWeight: 1.0,
                cohesionWeight: 0.0
            },
            'cohesion-only': {
                name: 'Cohesion Only',
                description: 'Pure cohesion behavior - boids cluster together chaotically.',
                maxSpeed: 4.0,
                maxForce: 0.1,
                perceptionRadius: 50,
                separationWeight: 0.0,
                alignmentWeight: 0.0,
                cohesionWeight: 1.0
            },
            'synchronized': {
                name: 'Highly Synchronized',
                description: 'Strong alignment creates highly coordinated parallel movement.',
                maxSpeed: 5.0,
                maxForce: 0.12,
                perceptionRadius: 80,
                separationWeight: 1.0,
                alignmentWeight: 3.0,
                cohesionWeight: 1.0
            }
        };

        // Global state
        let isRunning = true;
        let panels = [];

        // Create two simulation panels
        function createPanel(index, initialPreset) {
            const container = document.getElementById('container');
            const panelDiv = document.createElement('div');
            panelDiv.className = 'simulation-panel';

            const preset = PRESETS[initialPreset];

            panelDiv.innerHTML = `
                <div class="panel-header">
                    <div class="panel-title">Simulation ${index + 1}</div>
                    <select class="preset-selector" data-panel="${index}">
                        ${Object.keys(PRESETS).map(key =>
                            `<option value="${key}" ${key === initialPreset ? 'selected' : ''}>${PRESETS[key].name}</option>`
                        ).join('')}
                    </select>
                </div>
                <div class="description">
                    <div class="description-title">${preset.name}</div>
                    <div>${preset.description}</div>
                </div>
                <canvas id="canvas${index}" width="400" height="400"></canvas>
                <div class="controls">
                    <div class="control-group">
                        <span class="control-label">Max Speed</span>
                        <input type="range" class="slider" data-panel="${index}" data-param="maxSpeed"
                               min="0.5" max="10" step="0.1" value="${preset.maxSpeed}">
                        <span class="control-value" id="maxSpeed${index}">${preset.maxSpeed}</span>
                    </div>
                    <div class="control-group">
                        <span class="control-label">Perception Radius</span>
                        <input type="range" class="slider" data-panel="${index}" data-param="perceptionRadius"
                               min="10" max="150" step="5" value="${preset.perceptionRadius}">
                        <span class="control-value" id="perceptionRadius${index}">${preset.perceptionRadius}</span>
                    </div>
                    <div class="control-group">
                        <span class="control-label">Separation</span>
                        <input type="range" class="slider" data-panel="${index}" data-param="separationWeight"
                               min="0" max="5" step="0.1" value="${preset.separationWeight}">
                        <span class="control-value" id="separationWeight${index}">${preset.separationWeight}</span>
                    </div>
                    <div class="control-group">
                        <span class="control-label">Alignment</span>
                        <input type="range" class="slider" data-panel="${index}" data-param="alignmentWeight"
                               min="0" max="5" step="0.1" value="${preset.alignmentWeight}">
                        <span class="control-value" id="alignmentWeight${index}">${preset.alignmentWeight}</span>
                    </div>
                    <div class="control-group">
                        <span class="control-label">Cohesion</span>
                        <input type="range" class="slider" data-panel="${index}" data-param="cohesionWeight"
                               min="0" max="5" step="0.1" value="${preset.cohesionWeight}">
                        <span class="control-value" id="cohesionWeight${index}">${preset.cohesionWeight}</span>
                    </div>
                </div>
            `;

            container.appendChild(panelDiv);

            // Create simulation
            const canvas = document.getElementById(`canvas${index}`);
            const ctx = canvas.getContext('2d');
            const simulation = new Simulation(canvas.width, canvas.height);

            // Initialize with 50 boids per panel
            for (let i = 0; i < 50; i++) {
                simulation.addBoid();
            }

            // Apply preset
            applyPreset(simulation, index, preset);

            return {
                simulation,
                canvas,
                ctx,
                preset: initialPreset
            };
        }

        // Apply preset to simulation
        function applyPreset(simulation, index, preset) {
            simulation.updateParameters({
                maxSpeed: preset.maxSpeed,
                maxForce: preset.maxForce,
                perceptionRadius: preset.perceptionRadius
            });
            simulation.setBehaviorWeights(
                preset.separationWeight,
                preset.alignmentWeight,
                preset.cohesionWeight
            );

            // Update display
            document.getElementById(`maxSpeed${index}`).textContent = preset.maxSpeed.toFixed(1);
            document.getElementById(`perceptionRadius${index}`).textContent = preset.perceptionRadius;
            document.getElementById(`separationWeight${index}`).textContent = preset.separationWeight.toFixed(1);
            document.getElementById(`alignmentWeight${index}`).textContent = preset.alignmentWeight.toFixed(1);
            document.getElementById(`cohesionWeight${index}`).textContent = preset.cohesionWeight.toFixed(1);
        }

        // Initialize panels
        panels.push(createPanel(0, 'balanced'));
        panels.push(createPanel(1, 'chaotic'));

        // Event listeners for sliders
        document.querySelectorAll('.slider').forEach(slider => {
            slider.addEventListener('input', (e) => {
                const panelIndex = parseInt(e.target.dataset.panel);
                const param = e.target.dataset.param;
                const value = parseFloat(e.target.value);
                const panel = panels[panelIndex];

                document.getElementById(`${param}${panelIndex}`).textContent =
                    param === 'perceptionRadius' ? value : value.toFixed(1);

                if (param === 'separationWeight' || param === 'alignmentWeight' || param === 'cohesionWeight') {
                    const sep = parseFloat(document.querySelector(`[data-panel="${panelIndex}"][data-param="separationWeight"]`).value);
                    const align = parseFloat(document.querySelector(`[data-panel="${panelIndex}"][data-param="alignmentWeight"]`).value);
                    const coh = parseFloat(document.querySelector(`[data-panel="${panelIndex}"][data-param="cohesionWeight"]`).value);
                    panel.simulation.setBehaviorWeights(sep, align, coh);
                } else {
                    const params = {};
                    params[param] = value;
                    panel.simulation.updateParameters(params);
                }
            });
        });

        // Event listeners for preset selectors
        document.querySelectorAll('.preset-selector').forEach(selector => {
            selector.addEventListener('change', (e) => {
                const panelIndex = parseInt(e.target.dataset.panel);
                const presetKey = e.target.value;
                const preset = PRESETS[presetKey];
                const panel = panels[panelIndex];

                applyPreset(panel.simulation, panelIndex, preset);

                // Update description
                const descDiv = e.target.closest('.simulation-panel').querySelector('.description');
                descDiv.innerHTML = `
                    <div class="description-title">${preset.name}</div>
                    <div>${preset.description}</div>
                `;

                // Update sliders
                document.querySelector(`[data-panel="${panelIndex}"][data-param="maxSpeed"]`).value = preset.maxSpeed;
                document.querySelector(`[data-panel="${panelIndex}"][data-param="perceptionRadius"]`).value = preset.perceptionRadius;
                document.querySelector(`[data-panel="${panelIndex}"][data-param="separationWeight"]`).value = preset.separationWeight;
                document.querySelector(`[data-panel="${panelIndex}"][data-param="alignmentWeight"]`).value = preset.alignmentWeight;
                document.querySelector(`[data-panel="${panelIndex}"][data-param="cohesionWeight"]`).value = preset.cohesionWeight;

                panel.preset = presetKey;
            });
        });

        // Global control buttons
        document.getElementById('playPauseBtn').addEventListener('click', (e) => {
            isRunning = !isRunning;
            e.target.textContent = isRunning ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Play';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            panels.forEach(panel => {
                panel.simulation.reset();
            });
        });

        document.getElementById('syncBtn').addEventListener('click', () => {
            // Sync positions from panel 0 to panel 1
            const sourceBoids = panels[0].simulation.boids;
            const targetBoids = panels[1].simulation.boids;

            // Match boid count
            while (targetBoids.length < sourceBoids.length) {
                panels[1].simulation.addBoid();
            }
            while (targetBoids.length > sourceBoids.length) {
                targetBoids.pop();
            }

            // Copy positions and velocities
            for (let i = 0; i < sourceBoids.length; i++) {
                targetBoids[i].position = sourceBoids[i].position.copy();
                targetBoids[i].velocity = sourceBoids[i].velocity.copy();
            }
        });

        // Animation loop
        let lastTime = 0;
        let frameCount = 0;
        let fpsTime = 0;

        function animate(currentTime) {
            requestAnimationFrame(animate);

            if (!lastTime) lastTime = currentTime;
            const deltaTime = (currentTime - lastTime) / 1000;
            lastTime = currentTime;

            // Calculate FPS
            frameCount++;
            fpsTime += deltaTime;
            if (fpsTime >= 1.0) {
                document.getElementById('fps').textContent = `FPS: ${Math.round(frameCount / fpsTime)}`;
                frameCount = 0;
                fpsTime = 0;
            }

            // Update total boid count
            const totalBoids = panels.reduce((sum, panel) => sum + panel.simulation.boids.length, 0);
            document.getElementById('totalBoids').textContent = totalBoids;

            if (isRunning) {
                panels.forEach(panel => {
                    // Clear canvas
                    panel.ctx.fillStyle = '#0a0a0a';
                    panel.ctx.fillRect(0, 0, panel.canvas.width, panel.canvas.height);

                    // Update and render
                    panel.simulation.update();
                    panel.simulation.render(panel.ctx);
                });
            }
        }

        // Start animation
        requestAnimationFrame(animate);
    </script>
</body>
</html>
