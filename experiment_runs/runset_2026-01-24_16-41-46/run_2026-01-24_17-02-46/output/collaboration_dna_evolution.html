<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaboration DNA Evolution System</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        h2 {
            color: #4fc3f7;
            text-align: center;
            margin: 0 0 20px 0;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }

        .canvas-container {
            position: relative;
            height: 400px;
            background: radial-gradient(circle, rgba(79, 195, 247, 0.1) 0%, rgba(0, 0, 0, 0.3) 70%);
            border-radius: 8px;
            border: 2px solid rgba(79, 195, 247, 0.3);
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 6px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            background: linear-gradient(45deg, #4fc3f7, #29b6f6);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        button:hover {
            background: linear-gradient(45deg, #29b6f6, #0288d1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 195, 247, 0.4);
        }

        button:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(79, 195, 247, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(79, 195, 247, 0.3);
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }

        .stat-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #bbb;
            margin-top: 5px;
        }

        .dna-strand {
            height: 150px;
            background: linear-gradient(90deg,
                rgba(79, 195, 247, 0.2) 0%,
                rgba(156, 39, 176, 0.2) 25%,
                rgba(76, 175, 80, 0.2) 50%,
                rgba(255, 152, 0, 0.2) 75%,
                rgba(244, 67, 54, 0.2) 100%);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(79, 195, 247, 0.3);
        }

        .dna-helix {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0.6;
        }

        .evolution-log {
            height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.4;
            border: 1px solid rgba(79, 195, 247, 0.3);
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid;
            padding-left: 10px;
        }

        .log-mutation { border-left-color: #ff9800; }
        .log-crossover { border-left-color: #4caf50; }
        .log-breakthrough { border-left-color: #e91e63; }
        .log-evolution { border-left-color: #9c27b0; }

        .generation-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .generation {
            background: rgba(79, 195, 247, 0.1);
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid rgba(79, 195, 247, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }

        .generation:hover {
            background: rgba(79, 195, 247, 0.2);
            transform: scale(1.05);
        }

        .generation.active {
            background: rgba(79, 195, 247, 0.3);
            border-color: #4fc3f7;
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.5);
        }

        .fitness-score {
            font-size: 18px;
            font-weight: bold;
            color: #4fc3f7;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel full-width">
            <h2>üß¨ Collaboration DNA Evolution System üß¨</h2>
            <div class="controls">
                <button id="startEvolution">Start Evolution</button>
                <button id="pauseEvolution">Pause</button>
                <button id="resetEvolution">Reset Universe</button>
                <button id="injectMutation">Inject Mutation</button>
                <button id="forceCrossover">Force Crossover</button>
                <button id="exportDNA">Export DNA</button>
            </div>
        </div>

        <div class="panel">
            <h2>Living Ecosystem</h2>
            <div class="canvas-container">
                <canvas id="ecosystemCanvas"></canvas>
            </div>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="currentGeneration">0</div>
                    <div class="stat-label">Generation</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="bestFitness">0.0</div>
                    <div class="stat-label">Best Fitness</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="speciesCount">4</div>
                    <div class="stat-label">Active Species</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="mutationRate">5%</div>
                    <div class="stat-label">Mutation Rate</div>
                </div>
            </div>
        </div>

        <div class="panel">
            <h2>DNA Visualization</h2>
            <div class="dna-strand">
                <canvas id="dnaCanvas" class="dna-helix"></canvas>
            </div>
            <div class="generation-panel" id="generationPanel">
                <!-- Generations will be populated dynamically -->
            </div>
        </div>

        <div class="panel full-width">
            <h2>Evolution Chronicle</h2>
            <div class="evolution-log" id="evolutionLog">
                <div class="log-entry log-evolution">
                    üåü Evolution System Initialized - Universe Genesis Complete
                </div>
                <div class="log-entry log-mutation">
                    üî¨ Genetic algorithms primed for collaborative intelligence emergence
                </div>
            </div>
        </div>
    </div>

    <script>
        class CollaborationDNA {
            constructor() {
                this.genes = {
                    collaboration_tendency: Math.random(),
                    exploration_chaos: Math.random(),
                    synthesis_attraction: Math.random(),
                    validation_precision: Math.random(),
                    learning_adaptation: Math.random(),
                    emergence_sensitivity: Math.random(),
                    pattern_memory: Math.random(),
                    breakthrough_potential: Math.random()
                };
                this.fitness = 0;
                this.age = 0;
                this.lineage = [];
            }

            mutate(rate = 0.1) {
                const mutations = [];
                for (let gene in this.genes) {
                    if (Math.random() < rate) {
                        const oldValue = this.genes[gene];
                        this.genes[gene] += (Math.random() - 0.5) * 0.2;
                        this.genes[gene] = Math.max(0, Math.min(1, this.genes[gene]));
                        mutations.push({gene, oldValue, newValue: this.genes[gene]});
                    }
                }
                return mutations;
            }

            crossover(other) {
                const offspring = new CollaborationDNA();
                const crossoverPoints = [];

                for (let gene in this.genes) {
                    if (Math.random() > 0.5) {
                        offspring.genes[gene] = this.genes[gene];
                        crossoverPoints.push({gene, from: 'parent1'});
                    } else {
                        offspring.genes[gene] = other.genes[gene];
                        crossoverPoints.push({gene, from: 'parent2'});
                    }
                }

                offspring.lineage = [this, other];
                return {offspring, crossoverPoints};
            }

            calculateFitness(collaborationData) {
                // Complex fitness function based on emergence patterns
                let fitness = 0;

                fitness += this.genes.collaboration_tendency * collaborationData.connectionCount * 10;
                fitness += this.genes.exploration_chaos * collaborationData.noveltyScore * 15;
                fitness += this.genes.synthesis_attraction * collaborationData.synthesisEvents * 20;
                fitness += this.genes.validation_precision * collaborationData.validatedBreakthroughs * 25;
                fitness += this.genes.learning_adaptation * collaborationData.adaptationSuccess * 30;
                fitness += this.genes.emergence_sensitivity * collaborationData.emergenceEvents * 40;
                fitness += this.genes.pattern_memory * collaborationData.patternRecognition * 12;
                fitness += this.genes.breakthrough_potential * collaborationData.breakthroughCount * 50;

                this.fitness = fitness;
                return fitness;
            }
        }

        class EvolutionaryEcosystem {
            constructor() {
                this.population = [];
                this.generation = 0;
                this.populationSize = 20;
                this.eliteSize = 4;
                this.mutationRate = 0.05;
                this.isRunning = false;
                this.bestFitness = 0;
                this.evolutionHistory = [];
                this.collaborationSimulation = new CollaborationSimulation();

                this.initializePopulation();
                this.setupCanvas();
                this.setupDNAVisualization();
                this.setupEventListeners();
            }

            initializePopulation() {
                this.population = [];
                for (let i = 0; i < this.populationSize; i++) {
                    this.population.push(new CollaborationDNA());
                }
                this.updateGenerationDisplay();
            }

            setupCanvas() {
                this.canvas = document.getElementById('ecosystemCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.canvas.width = this.canvas.offsetWidth;
                this.canvas.height = this.canvas.offsetHeight;
            }

            setupDNAVisualization() {
                this.dnaCanvas = document.getElementById('dnaCanvas');
                this.dnaCtx = this.dnaCanvas.getContext('2d');
                this.dnaCanvas.width = this.dnaCanvas.offsetWidth;
                this.dnaCanvas.height = this.dnaCanvas.offsetHeight;
                this.drawDNAHelix();
            }

            setupEventListeners() {
                document.getElementById('startEvolution').addEventListener('click', () => this.startEvolution());
                document.getElementById('pauseEvolution').addEventListener('click', () => this.pauseEvolution());
                document.getElementById('resetEvolution').addEventListener('click', () => this.resetEvolution());
                document.getElementById('injectMutation').addEventListener('click', () => this.injectMutation());
                document.getElementById('forceCrossover').addEventListener('click', () => this.forceCrossover());
                document.getElementById('exportDNA').addEventListener('click', () => this.exportBestDNA());
            }

            startEvolution() {
                this.isRunning = true;
                this.log("üöÄ Evolution Engine Started - Natural Selection Active", 'evolution');
                this.evolutionLoop();
            }

            pauseEvolution() {
                this.isRunning = false;
                this.log("‚è∏Ô∏è Evolution Paused - Ecosystem Frozen", 'evolution');
            }

            resetEvolution() {
                this.isRunning = false;
                this.generation = 0;
                this.bestFitness = 0;
                this.evolutionHistory = [];
                this.initializePopulation();
                this.clearLog();
                this.log("üîÑ Universe Reset - New Genesis Initiated", 'evolution');
                this.updateStats();
            }

            async evolutionLoop() {
                while (this.isRunning) {
                    await this.evolveGeneration();
                    await this.sleep(2000); // 2 second generations
                }
            }

            async evolveGeneration() {
                // Run collaboration simulation to generate fitness data
                const collaborationData = await this.runCollaborationSimulation();

                // Calculate fitness for each individual
                this.population.forEach(individual => {
                    individual.calculateFitness(collaborationData);
                    individual.age++;
                });

                // Sort by fitness
                this.population.sort((a, b) => b.fitness - a.fitness);

                // Track best fitness
                if (this.population[0].fitness > this.bestFitness) {
                    this.bestFitness = this.population[0].fitness;
                    this.log(`üèÜ New Fitness Record: ${this.bestFitness.toFixed(2)} - Superior Intelligence Emerged!`, 'breakthrough');
                }

                // Create next generation
                const newPopulation = [];

                // Elite survival
                for (let i = 0; i < this.eliteSize; i++) {
                    newPopulation.push(this.population[i]);
                }

                // Generate offspring
                while (newPopulation.length < this.populationSize) {
                    const parent1 = this.tournamentSelection();
                    const parent2 = this.tournamentSelection();
                    const {offspring, crossoverPoints} = parent1.crossover(parent2);

                    this.log(`üß¨ Genetic Crossover: ${crossoverPoints.length} genes exchanged`, 'crossover');

                    // Mutation
                    const mutations = offspring.mutate(this.mutationRate);
                    if (mutations.length > 0) {
                        this.log(`‚ö° Mutation Event: ${mutations.length} genes altered`, 'mutation');
                    }

                    newPopulation.push(offspring);
                }

                this.population = newPopulation;
                this.generation++;

                // Adaptive mutation rate
                this.mutationRate = 0.05 + (0.1 * Math.exp(-this.generation / 20));

                this.updateStats();
                this.updateGenerationDisplay();
                this.visualizeEcosystem();
                this.drawDNAHelix();

                this.log(`üåç Generation ${this.generation} Complete - Population Evolved`, 'evolution');
            }

            async runCollaborationSimulation() {
                // Simulate collaboration with current best DNA
                const bestDNA = this.population[0];

                return {
                    connectionCount: Math.random() * 50 + bestDNA.genes.collaboration_tendency * 30,
                    noveltyScore: Math.random() * 40 + bestDNA.genes.exploration_chaos * 25,
                    synthesisEvents: Math.random() * 20 + bestDNA.genes.synthesis_attraction * 15,
                    validatedBreakthroughs: Math.random() * 10 + bestDNA.genes.validation_precision * 8,
                    adaptationSuccess: Math.random() * 30 + bestDNA.genes.learning_adaptation * 20,
                    emergenceEvents: Math.random() * 15 + bestDNA.genes.emergence_sensitivity * 12,
                    patternRecognition: Math.random() * 35 + bestDNA.genes.pattern_memory * 25,
                    breakthroughCount: Math.random() * 8 + bestDNA.genes.breakthrough_potential * 6
                };
            }

            tournamentSelection() {
                const tournamentSize = 3;
                const tournament = [];

                for (let i = 0; i < tournamentSize; i++) {
                    tournament.push(this.population[Math.floor(Math.random() * this.population.length)]);
                }

                tournament.sort((a, b) => b.fitness - a.fitness);
                return tournament[0];
            }

            injectMutation() {
                const individual = this.population[Math.floor(Math.random() * this.population.length)];
                const mutations = individual.mutate(0.5); // High mutation rate
                this.log(`üí• Forced Mutation Injected: ${mutations.length} radical genetic changes`, 'mutation');
            }

            forceCrossover() {
                const parent1 = this.population[0]; // Best individual
                const parent2 = this.population[1]; // Second best
                const {offspring} = parent1.crossover(parent2);

                // Replace worst individual
                this.population[this.population.length - 1] = offspring;
                this.log(`üîÄ Forced Elite Crossover: Superior genetics combined`, 'crossover');
            }

            exportBestDNA() {
                const bestIndividual = this.population[0];
                const dnaData = {
                    generation: this.generation,
                    fitness: bestIndividual.fitness,
                    genes: bestIndividual.genes,
                    timestamp: new Date().toISOString()
                };

                const dataStr = JSON.stringify(dnaData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

                const exportFileDefaultName = `collaboration-dna-gen${this.generation}.json`;

                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();

                this.log(`üì§ Elite DNA Exported: Generation ${this.generation} Superior Intelligence`, 'evolution');
            }

            visualizeEcosystem() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

                // Draw population as organisms
                const cols = 5;
                const rows = 4;
                const cellWidth = this.canvas.width / cols;
                const cellHeight = this.canvas.height / rows;

                this.population.slice(0, 20).forEach((individual, index) => {
                    const x = (index % cols) * cellWidth + cellWidth / 2;
                    const y = Math.floor(index / cols) * cellHeight + cellHeight / 2;

                    // Color based on fitness
                    const fitnessRatio = individual.fitness / (this.bestFitness || 1);
                    const hue = fitnessRatio * 120; // Green for high fitness
                    const saturation = 70 + fitnessRatio * 30;
                    const lightness = 40 + fitnessRatio * 40;

                    this.ctx.fillStyle = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, 15 + fitnessRatio * 10, 0, Math.PI * 2);
                    this.ctx.fill();

                    // Draw connections based on collaboration tendency
                    if (individual.genes.collaboration_tendency > 0.7) {
                        this.ctx.strokeStyle = `hsla(${hue}, ${saturation}%, ${lightness}%, 0.3)`;
                        this.ctx.lineWidth = 2;
                        this.ctx.beginPath();
                        this.ctx.arc(x, y, 25 + fitnessRatio * 15, 0, Math.PI * 2);
                        this.ctx.stroke();
                    }

                    // Fitness label
                    this.ctx.fillStyle = '#fff';
                    this.ctx.font = '10px monospace';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText(individual.fitness.toFixed(0), x, y + 35);
                });
            }

            drawDNAHelix() {
                this.dnaCtx.clearRect(0, 0, this.dnaCanvas.width, this.dnaCanvas.height);

                if (this.population.length === 0) return;

                const bestDNA = this.population[0];
                const time = Date.now() * 0.001;
                const centerX = this.dnaCanvas.width / 2;
                const amplitude = this.dnaCanvas.width * 0.3;
                const frequency = 0.02;

                // Draw DNA double helix
                const geneNames = Object.keys(bestDNA.genes);
                geneNames.forEach((gene, index) => {
                    const value = bestDNA.genes[gene];
                    const y = (index / geneNames.length) * this.dnaCanvas.height;

                    // Helix strand 1
                    const x1 = centerX + Math.sin(y * frequency + time) * amplitude * value;
                    // Helix strand 2
                    const x2 = centerX - Math.sin(y * frequency + time) * amplitude * value;

                    // Color based on gene strength
                    const hue = (index / geneNames.length) * 360;
                    const alpha = 0.6 + value * 0.4;

                    this.dnaCtx.fillStyle = `hsla(${hue}, 70%, 60%, ${alpha})`;
                    this.dnaCtx.beginPath();
                    this.dnaCtx.arc(x1, y, 4, 0, Math.PI * 2);
                    this.dnaCtx.fill();

                    this.dnaCtx.beginPath();
                    this.dnaCtx.arc(x2, y, 4, 0, Math.PI * 2);
                    this.dnaCtx.fill();

                    // Connection between strands
                    this.dnaCtx.strokeStyle = `hsla(${hue}, 70%, 60%, 0.3)`;
                    this.dnaCtx.lineWidth = 2;
                    this.dnaCtx.beginPath();
                    this.dnaCtx.moveTo(x1, y);
                    this.dnaCtx.lineTo(x2, y);
                    this.dnaCtx.stroke();
                });

                // Gene labels
                this.dnaCtx.fillStyle = '#4fc3f7';
                this.dnaCtx.font = '10px monospace';
                this.dnaCtx.textAlign = 'left';
                geneNames.forEach((gene, index) => {
                    const y = (index / geneNames.length) * this.dnaCanvas.height + 5;
                    const value = bestDNA.genes[gene];
                    this.dnaCtx.fillText(`${gene}: ${value.toFixed(3)}`, 10, y);
                });
            }

            updateStats() {
                document.getElementById('currentGeneration').textContent = this.generation;
                document.getElementById('bestFitness').textContent = this.bestFitness.toFixed(2);
                document.getElementById('mutationRate').textContent = (this.mutationRate * 100).toFixed(1) + '%';

                // Count active species (individuals with fitness above threshold)
                const activeSpecies = this.population.filter(ind => ind.fitness > this.bestFitness * 0.8).length;
                document.getElementById('speciesCount').textContent = activeSpecies;
            }

            updateGenerationDisplay() {
                const panel = document.getElementById('generationPanel');
                const recentGenerations = Math.min(8, this.generation + 1);

                panel.innerHTML = '';
                for (let i = Math.max(0, this.generation - recentGenerations + 1); i <= this.generation; i++) {
                    const genDiv = document.createElement('div');
                    genDiv.className = `generation ${i === this.generation ? 'active' : ''}`;
                    genDiv.innerHTML = `
                        <div>Gen ${i}</div>
                        <div class="fitness-score">${i <= this.generation ? this.bestFitness.toFixed(1) : '---'}</div>
                    `;
                    panel.appendChild(genDiv);
                }
            }

            log(message, type = 'evolution') {
                const logDiv = document.getElementById('evolutionLog');
                const entry = document.createElement('div');
                entry.className = `log-entry log-${type}`;
                entry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
                logDiv.appendChild(entry);
                logDiv.scrollTop = logDiv.scrollHeight;
            }

            clearLog() {
                document.getElementById('evolutionLog').innerHTML = '';
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Simplified collaboration simulation for demonstration
        class CollaborationSimulation {
            constructor() {
                this.agents = ['Analyzer', 'Synthesizer', 'Explorer', 'Validator'];
            }
        }

        // Initialize the evolution system
        const evolutionSystem = new EvolutionaryEcosystem();

        // Animation loop for continuous DNA visualization
        function animationLoop() {
            evolutionSystem.drawDNAHelix();
            requestAnimationFrame(animationLoop);
        }
        animationLoop();
    </script>
</body>
</html>